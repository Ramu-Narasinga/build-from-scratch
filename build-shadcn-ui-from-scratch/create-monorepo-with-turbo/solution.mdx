# Create a monorepo with Turbo Solution

This challenge has 4 steps to complete:

1. Create and clone a Github repository to your local machine.
2. Create a monorepo using Turbo.
3. Understanding the monorepo.
4. Push your code to Github

## 1. Create and clone a Github repository in your local machine

This video shows how you can create a Github repository and clone a repo to your local machine.

[Insert video execution. Loom or Github?]

Links to documentation:

1. [Create a repository](https://docs.github.com/en/repositories/creating-and-managing-repositories/quickstart-for-repositories)
2. [Clone a repository](https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository?platform=linux&tool=cli)

## 2. Create a monorepo using Turbo

This guide provides the instructions to create a monorepo using Turbo and helps you understand the turbo basics.

### Step 1: Run `create-turbo`:

Make sure you are in the root of your local repository. Run this below command:

```
npx create-turbo@latest
```
### Step 2: Enter y to install create-turbo:

Press "y" when the CLI prompts to install create-turbo package, 

[insert screenshot of need to install package]

Once this package is installed, you will be prompted with the following questions on your CLI:

### Step 3: Choose a folder location for your turborepo

_Where would you like to create your turborepo?_

[insert screenshot of question]

Enter ./ in your CLI so you can use your repository's root folder to create turborepo

### Step 4: Choose a package manager:

_Which package manager do you want to use?_

[insert screenshot of question]

Turbo recommends pnpm. Choose pnpm as your package manager.

After you choose the package manager, `create-turbo` creates a bunch of files and folders inside your selected folder for turborepo (Remember when you were asked this question above?) and also installs the dependencies that come with this basic example.

[insert screenshot of successful installation]

## 3. Understanding the monorepo

when you create a new monorepo, `create-turbo` command gives you a description of folders it creates.

```
>>> Creating a new turborepo with the following:
 - apps/web: Next.js with TypeScript
 - apps/docs: Next.js with TypeScript
 - packages/ui: Shared React component library
 - packages/eslint-config: Shared configuration (ESLint)
 - packages/typescript-config: Shared TypeScript `tsconfig.json`
```

These folders are called workspaces. Each workspace has its own package.json, run their scripts and export code that can be used by other workspaces in the monorepo.

### packages/ui, a shared component library

Open `package/ui/package,json` and you will find the name as `@repo/ui`.

[insert screenshot of name in package.json]

If you open `apps/web/package.json` and `apps/docs/package.json`, you will find `@repo/ui` as a dependency.

[insert dependency screenshots]

`packages/ui` is a shared component library because `apps/web` and `apps/docs` depend on `packages/ui` for a consistent, single design system

#### How does packages/ui share code?

Inside `./apps/docs/app/page.tsx`, you will find the below import.

[Insert screenshot of import]

Button is imported from `@repo/ui/button` but, how is this exported from `packages/ui`?

You will find `exports` field in `packages/ui/package.json`.

[Insert screenshot here of exports]

components from `packages/ui` are exported using the exports field.

For example, when `apps/web` workspace file imports a shared component, say `Button`, from `packages/ui`, exports tells the `apps/web` workspace where to find this Button component.

[insert Button code screenshot]

### typescript-config workspace

You will find that this workspace is named as `@repo/typescript-config` in `packages/typescript-config/package.json`.

To share a single tsconfig.json across the monorepo, you can use this typescript-config workspace by importing `@repo/typescript-config/nextjs.json` in `apps/web/tsconfig.json`.

[insert its screenshot]

### eslint-config workspace

You will find that this workspace is named as `@repo/eslint-config` in `packages/eslint-config/package.json`.

To share a single eslint config file across the monorepo, you can use this eslint-config workspace by importing `@repo/eslint-config/next.js` in `apps/docs/.eslintrc.js`.

[insert its screenshot]

To summarise, the following list shows dependencies among workspaces:

1. `web` - depends on `ui`, `typescript-config` and `eslint-config`
2. `docs` - depends on `ui`, `typescript-config` and `eslint-config`
3. `ui` - depends on `typescript-config` and `eslint-config`
4. `typescript-config` - no dependencies
`eslint-config` - no dependencies

Turborepo CLI does not manage these dependencies. Your package manager (`npm`, `pnpm` or `yarn`) handles the workspace dependencies.

### `turbo.json` explained

Turborepo makes running tasks simpler and efficient.

code inside `turbo.json`:

```
{
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "!.next/cache/**"]
    },
    "lint": {
      "dependsOn": ["^lint"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
```

What the code above means is that we have 3 tasks registered in `turbo.json`.

1. `build`
2. `lint`
3. `dev`

To run a specific task, you can use the command below:

```
turbo run <task>
```

or using a shorter version:

```
turbo  <task>
```

### turbo run lint

Run the command `turbo run lint` and notice what happens in your CLI.

Because workspaces such as `ui`, `docs` and `web` depend on eslint config provided by the shared workspace `eslint-config`, you will find that the command you just ran triggers the 
lint scripts in the dependant workspaces.

#### lint script in `ui` workspace:

[insert screenshot here]

#### lint script in `web` workspace:

[insert screenshot here]

#### lint script in `ui` workspace:

[insert screenshot here]

You will also see `0 cached, 3 total` in your CLI.

#### Caching turbo task

Run the lint task without changing any code in workspaces, commands executes quickly and runtime is shorter because Turborepo recognised that no code has been changed, hence it replays the previous task run log.

Let's make a change in `ui` workspace. Change the onClick method's alert message from:

```
<button
      className={className}
      onClick={() => alert(`Hello from your ${appName} app!`)}
    >
```
to

```
<button
      className={className}
      onClick={() => alert(`Hello there, this alert is from your ${appName} app!`)}
    >
```

What we are changing is the alert message from `Hello from your ${appName} app!` to `Hello there, this alert is from your ${appName} app!`.

Run the lint again. You'll find that:

1. `ui:lint` has a comment saying `cache mis`s, executing. This means that `ui` workspace is running its linting script.
2. `2 cached, 3 total` appears at the bottom.

Since only `ui` workspace had code changes, its lint script is run. Other workspace results are cached from previous runs.

### turbo run build

Check for the `build` key in `scripts` in `package.json`. You will find that `build` script is available only for `web` and `docs` packages since `ui` package is a shared workspace

Run the below command to run the `build` scripts defined in `web` and `docs` workspaces.

```
turbo run build
```

#### Caching `build` results:

`outputs` defined in `build` task in `turbo.json` are the build outputs in workspaces. For example, in the `app/web`, once the `turbo build` is run, build script in `app/web` produces the Next.js build located at `./next` folder. 

`turbo` caches the folders mentioned in the build task's `outputs`

### turbo run dev

Run the below command.

```
turbo run dev
```
This above command executes the `dev` script in `web` and `docs` workspaces but not in `ui` workspace since it does not have `dev` script.

`dev` scripts are run simultaneously, starting the dev servers on ports `3000` and `3001`.

There is no caching in the `dev` task.

```
{
  "pipeline": {
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
``` 

since `dev` command runs a development server and produces no results, cache is disabled and persistent is set to true. 

To run dev script in a specific workspace, use the below command

```
turbo dev --filter docs
```